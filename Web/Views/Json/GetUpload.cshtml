@using SL.Util
@{
    int accountId;

    if (!SL.Web.Service.UserService.CheckAuth(out accountId))
    {
        return;
    }

    RequestUtil req = new RequestUtil();

    int transferId = req.Int("TransferID", false, "缺少单据编号");
    int page = req.Int("page", defaultValue: 1);
    int pageSize = req.Int("pageSize", defaultValue: 20);

    if (req.HasError)
    {
        Json.Write(new { success = false, returnCode = "0000", msg = req.FirstError, errors = req.GetErrors() }, Output);
        return;
    }

    int total;
    var data = SL.Data.SQL.QueryPage("PhotoID",
            "PhotoID,AccountID,TransferID,Photo,Description ",
            "[Photo]",
            "TransferID=@p0",
            page,
            pageSize,
            new object[] { transferId },
            out total);

    Json.Write(new { success = true, data = data, total = total }, Output);
    return;
}
